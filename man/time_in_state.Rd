% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sops.R
\name{time_in_state}
\alias{time_in_state}
\title{Compute Total Time in Target State(s)}
\usage{
time_in_state(sops, target_states = 1)
}
\arguments{
\item{sops}{Input object.
\itemize{
\item \strong{Array:} \verb{[Patients x Time x States]} (Frequentist) or \verb{[Draws x Patients x Time x States]} (Bayes).
\item \strong{Data Frame:} Output from \code{bootstrap_standardized_sops} containing columns \code{boot_id}, \code{time}, \code{tx}, and \verb{state_*}.
}}

\item{target_states}{Vector of target state(s) to include in the time calculation.
Can be integer indices or character names (e.g., \code{1} or \code{c("Home", "Rehab")}).
For bootstrap outputs, these must match the suffix of the \code{state_} columns (e.g., if column is \code{state_1}, use \code{1}).}
}
\value{
\itemize{
\item \strong{Input = Array (Frequentist):} A named numeric vector of length \code{n_patients}.
\item \strong{Input = Array (Bayesian):} A matrix of dimension \code{[n_draws x n_patients]}.
\item \strong{Input = Bootstrap DF:} A tibble with columns:
\itemize{
\item \code{boot_id}: Bootstrap iteration
\item \code{SOP_tx}: Mean time in target state (Treatment)
\item \code{SOP_ctrl}: Mean time in target state (Control)
\item \code{delta}: Difference (Treatment - Control)
}
}
}
\description{
Calculates the expected total time spent in specified target state(s).
This function integrates state occupancy probabilities over time assuming unit steps.
It automatically adapts to the input format:
\itemize{
\item \strong{Patient-Level:} If input is an array from \code{\link{soprob_markov_vectorized}}, it returns time-in-state for each patient.
\item \strong{Bootstrap-Level:} If input is a data frame from \code{\link{bootstrap_standardized_sops}}, it returns mean time-in-state per treatment group and the difference for each bootstrap sample.
}
}
\examples{
\dontrun{
# --- Scenario 1: Patient-Level Estimates ---
sops_arr <- soprob_markov(model, data, times = 1:30, ylevels = 1:6)
days_home <- time_in_state(sops_arr, target_states = 1)

# --- Scenario 2: Bootstrap Inference ---
bs_res <- bootstrap_standardized_sops(model, data, n_boot=100)
# Get distribution of treatment effects
bs_effects <- time_in_state(bs_res, target_states = 1)
}

}
\keyword{auc}
\keyword{bootstrap}
\keyword{time-in-state}
