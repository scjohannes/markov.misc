% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_trajectories.R
\name{simulate_trajectories}
\alias{simulate_trajectories}
\title{Simulate Individual Patient Trajectories Using Markov Model}
\usage{
simulate_trajectories(
  baseline_data,
  follow_up_time = 60,
  intercepts = c(-9.353417, -4.294121, -1.389221, -0.555688, 3.127056),
  lp_function,
  extra_params = c(time = -0.738194, `time'` = 0.7464006, age = 0.010321, sofa =
    0.046901, `yprev=1` = -9.464827, `yprev=3` = 0.438444, `yprev=4` = 0.657666,
    `yprev=5` = 6.576662, `yprev=1 * time` = 0, `yprev=3 * time` = 0, `yprev=4 * time` =
    0, `yprev=5 * time` = 0),
  parameter = 0,
  absorbing_states = 6,
  seed = NULL,
  covariate_names = c("age", "sofa", "tx")
)
}
\arguments{
\item{baseline_data}{A data frame containing baseline patient characteristics.
Must include columns: \code{id}, \code{yprev} (initial state), and any covariates
needed by \code{lp_function}. Typically includes \code{tx}, \code{age}, \code{sofa}, etc.}

\item{follow_up_time}{Integer. Number of time periods to simulate (default: 60).}

\item{intercepts}{Numeric vector of intercepts for the proportional odds model.
Should have length = (number of states - 1). Default values are from VIOLET
study with 6-state expansion:
c(-9.353, -4.294, -1.389, -0.556, 3.127)}

\item{lp_function}{A function that calculates the linear predictor for each
patient at each time point. Should accept parameters:
\itemize{
\item yprev: previous state
\item t: current time
\item tx: treatment indicator
\item Additional named arguments matching columns in \code{baseline_data}
\item parameter: treatment effect (log odds ratio)
\item extra_params: named vector of coefficients
Must return a numeric value representing the linear predictor.
}}

\item{extra_params}{Named numeric vector of model coefficients used by
\code{lp_function}. Default values from VIOLET study include time, spline,
age, sofa, and previous state effects with interactions.}

\item{parameter}{Numeric. Treatment effect on log odds ratio scale (default: 0,
meaning odds ratio = 1).}

\item{absorbing_states}{Integer vector of states that are absorbing (once
entered, patients cannot leave). Default is 6 (death).}

\item{seed}{Integer. Random seed for reproducibility (default: NULL, no seed set).}

\item{covariate_names}{Character vector of covariate names from \code{baseline_data}
to pass to \code{lp_function}. Default is c("age", "sofa", "tx"). The function
will automatically detect and pass these to \code{lp_function}.}
}
\value{
A data frame with columns:
\itemize{
\item id: patient identifier
\item time: time point (1 to follow_up_time)
\item y: observed state at this time
\item yprev: state at previous time point
\item all columns from baseline_data
}
}
\description{
This function generates individual patient trajectories over time based on
a proportional odds model with customizable intercepts, linear predictor
function, and baseline patient characteristics.
}
\details{
The function implements a discrete-time Markov model where transition
probabilities are determined by a proportional odds model. At each time step:
\enumerate{
\item Calculate linear predictor for each active patient
\item Apply intercepts to get cumulative probabilities
\item Convert to state probabilities
\item Sample next state for each patient
\item Patients in absorbing states remain there
}

States are assumed to be ordered integers (e.g., 1=Home, 2=Hospital mild,
3=Hospital oxygen, 4=Hospital NIV, 5=Ventilator, 6=Death). The model
uses a proportional odds structure where higher intercepts represent
more severe health states.
}
\examples{
\dontrun{
# Using default VIOLET parameters
baseline <- data.frame(
  id = 1:100,
  yprev = sample(2:5, 100, replace = TRUE),
  tx = rbinom(100, 1, 0.5),
  age = rnorm(100, 60, 15),
  sofa = rpois(100, 5)
)

# Define a simple linear predictor function
my_lp <- function(yprev, t, age, sofa, tx, parameter = 0, extra_params) {
  tx_effect <- parameter * tx
  sofa_effect <- extra_params["sofa"] * sofa
  age_effect <- extra_params["age"] * age
  time_effect <- extra_params["time"] * t
  time_2_effect <- extra_params["time'"] * pmax(t - 2, 0)

  yprev_effect <- 0
  yprev_time_effect <- 0
  if (yprev != 2) {
    yprev_coef_name <- paste0('yprev=', yprev)
    if (yprev_coef_name \%in\% names(extra_params)) {
      yprev_effect <- extra_params[[yprev_coef_name]]
    }
    yprev_time_name <- paste0('yprev=', yprev, ' * time')
    if (yprev_time_name \%in\% names(extra_params)) {
      yprev_time_effect <- extra_params[[yprev_time_name]] * t
    }
  }

  lp <- as.numeric(tx_effect + sofa_effect + age_effect +
                   time_effect + time_2_effect +
                   yprev_effect + yprev_time_effect)
  return(lp)
}

trajectories <- simulate_trajectories(
  baseline_data = baseline,
  follow_up_time = 30,
  lp_function = my_lp,
  parameter = log(0.8),  # OR = 0.8
  seed = 12345
)
}

}
