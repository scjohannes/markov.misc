% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mvn_helpers.R
\name{get_vcov_robust}
\alias{get_vcov_robust}
\title{Get Robust Variance-Covariance Matrix}
\usage{
get_vcov_robust(model, cluster = NULL, data = NULL, adjust = FALSE)
}
\arguments{
\item{model}{A fitted model object (e.g., \code{vglm}, \code{orm}, \code{lrm}) or a
\code{robcov_vglm} object (which already contains robust vcov).}

\item{cluster}{Optional. Specifies how to compute cluster-robust standard
errors:
\itemize{
\item \code{NULL}: Use standard (model-based) vcov
\item Formula (e.g., \code{~id}): Extract cluster variable from the model's
original fitting data and compute cluster-robust vcov
\item Character/numeric vector: Cluster variable values directly (must
match the number of observations used to fit the model)
}}

\item{data}{Data frame. Optional. If \code{cluster} is a formula and the cluster
variable cannot be found in the model's original data, it will be extracted
from this data frame. \strong{Note:} For cluster-robust SEs, the cluster vector
must have the same length as the model's fitting data, not prediction data.}

\item{adjust}{Logical. Apply small-sample correction for clustering?
Default is FALSE to match \code{rms::robcov()} behavior.}
}
\value{
A variance-covariance matrix.
}
\description{
Extracts or computes a (cluster-)robust variance-covariance matrix for
use in simulation-based inference. This function provides a unified
interface for obtaining robust vcov from different model types.
}
\details{
This function handles several cases:

\strong{1. Pre-computed robust vcov (\code{robcov_vglm} object):}
If the model is already a \code{robcov_vglm} object (from calling
\code{robcov_vglm()}), the stored robust vcov is returned directly.

\strong{2. No clustering requested:}
If \code{cluster = NULL}, returns the standard model-based vcov from \code{vcov()}.

\strong{3. Cluster formula:}
If \code{cluster} is a formula like \code{~id}, the function first tries to extract
the cluster variable from the model's original fitting data (by evaluating
the \code{data} argument from the model's call). This ensures the cluster vector
has the correct length for computing robust standard errors.

\strong{Important:} Cluster-robust standard errors are computed from the model's
score contributions, which have length equal to the number of observations
used to fit the model. The cluster variable must therefore match this length,
NOT the length of any new prediction data.
}
\examples{
\dontrun{
library(VGAM)

# Fit a model
fit <- vglm(y ~ yprev + time + tx,
            family = cumulative(parallel = TRUE, reverse = TRUE),
            data = mydata)

# Standard vcov
V1 <- get_vcov_robust(fit)

# Cluster-robust vcov using formula (extracts 'id' from model's data)
V2 <- get_vcov_robust(fit, cluster = ~id)

# Pre-computed robust vcov
fit_robust <- robcov_vglm(fit, cluster = mydata$id)
V3 <- get_vcov_robust(fit_robust)  # Same as fit_robust$var
}

}
\seealso{
\code{\link[=robcov_vglm]{robcov_vglm()}}, \code{\link[rms:robcov]{rms::robcov()}}, \code{\link[=set_coef]{set_coef()}}
}
