% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/taooh_bootstrap.R
\name{bootstrap_model_coefs}
\alias{bootstrap_model_coefs}
\title{Bootstrap confidence intervals for model coefficients}
\usage{
bootstrap_model_coefs(
  model,
  data = NULL,
  n_boot,
  workers = NULL,
  parallel = TRUE,
  id_var = "id"
)
}
\arguments{
\item{model}{A fitted model object from \code{rms::orm}. Should be fitted
with \code{x = TRUE, y = TRUE} to enable model updating with bootstrap samples.}

\item{data}{A data frame containing the patient data. This is required (cannot be NULL)
because the ID variable is needed for group bootstrap but is typically not included
in the model formula.}

\item{n_boot}{Number of bootstrap samples}

\item{workers}{Number of workers used for parallelization. Default is
parallel::detectCores() - 1}

\item{parallel}{Whether parallelization should be used (default TRUE)}

\item{id_var}{Name of the ID variable for group bootstrap (default "id")}
}
\value{
A tibble with bootstrap results. Each row represents one bootstrap
iteration and contains:
\itemize{
\item boot_id: Bootstrap iteration number
\item All model coefficients (both intercepts and slope parameters)
}
}
\description{
Performs group bootstrap resampling to compute confidence intervals for all
model parameters (intercepts and coefficients). This is a general-purpose
bootstrap function that works with any \code{rms::orm} model.
}
\details{
Uses group bootstrap resampling (resampling by patient ID) to preserve the
within-patient correlation structure. For each bootstrap iteration:
\enumerate{
\item Extracts the bootstrap sample and creates unique IDs
\item Relevels factor variables to handle missing levels (converts to consecutive integers)
\item Updates the datadist in the global environment (safe with future.callr)
\item Refits the model using \code{update()} with the bootstrap sample
\item Extracts all coefficients from the refitted model
}

\strong{Handling missing factor levels:} When certain factor levels are absent
from a bootstrap sample, the function automatically relevels ordered factors
(like state variables) to consecutive integers. This prevents model fitting
failures while maintaining the ordinal structure.

Parallelization is handled via future.callr::callr strategy, which provides
isolated R processes for each worker, making it safe to modify the global
environment (for datadist) without conflicts.

The returned tibble can be used to compute confidence intervals using
quantile-based methods (percentile or BCa intervals).

\strong{Important:} Factor variables (like \code{yprev}) should be factors
before fitting the model for proper handling of factor levels.
}
\examples{
\dontrun{
# Fit initial model (note: id is NOT in the formula but is needed for bootstrap)
d <- rms::datadist(my_data)
options(datadist = "d")
m <- orm(y ~ tx + yprev + time, data = my_data, x = TRUE, y = TRUE)

# Bootstrap all coefficients (must provide data with id variable)
bs_coefs <- bootstrap_model_coefs(
  model = m,
  data = my_data,  # Required - must contain id variable
  n_boot = 1000
)

# Compute 95\% confidence intervals
library(dplyr)
ci_results <- bs_coefs |>
  summarise(across(-boot_id, list(
    lower = ~quantile(.x, 0.025, na.rm = TRUE),
    upper = ~quantile(.x, 0.975, na.rm = TRUE)
  )))
}
}
\keyword{bootstrap}
\keyword{coefficients}
\keyword{confidence}
\keyword{intervals}
