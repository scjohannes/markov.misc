% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/power.R
\name{prepare_markov_data}
\alias{prepare_markov_data}
\title{Prepare Markov Data for Proportional Odds Modeling}
\usage{
prepare_markov_data(
  data,
  absorbing_state = 6,
  ordered_response = TRUE,
  factor_previous = TRUE
)
}
\arguments{
\item{data}{A data frame containing Markov trajectory data with columns
\code{y} (current state) and \code{yprev} (previous state).}

\item{absorbing_state}{Integer. The absorbing state to filter out (default: 6
for death). Observations where \code{yprev} equals this value are removed.}

\item{ordered_response}{Logical. Should \code{y} be converted to ordered factor?
(default: TRUE). Required for clm and vglm, not required for orm.}

\item{factor_previous}{Logical. Should \code{yprev} be converted to factor?
(default: TRUE).}
}
\value{
A data frame with modified \code{y} and \code{yprev} columns and absorbing
states removed.
}
\description{
Prepares longitudinal Markov trajectory data for proportional odds regression
by removing absorbing states and converting variables to appropriate types.
Works with both VGAM::vglm and rms::orm models.
}
\details{
This is a convenience function that performs standard data preparation for
proportional odds models on Markov data:
\itemize{
\item Removes rows where patients were in an absorbing state at the previous time
\item Converts current state to ordered factor (for cumulative models)
\item Converts previous state to factor (for including as predictor)
}

\strong{Package compatibility}: This function prepares data for:
\itemize{
\item \strong{VGAM::vglm}: Use \code{cumulative(parallel = TRUE, reverse = TRUE)} default
datasets.
\item \strong{rms::orm}: Automatically treats integers as ordered factors.
\item \strong{ordinal::clm}: Only accepts ordered factors.
}
}
\examples{
\dontrun{
# Prepare data
model_data <- prepare_markov_data(trajectories)

# Fit with VGAM (no robust SEs; use bootstrap for inference)
library(VGAM)
fit <- vglm(y ~ tx + rcs(time, 4) + yprev,
            family = cumulative(parallel = TRUE, reverse = TRUE),
            data = model_data)

# Fit with rms (supports robust SEs via robcov)
library(rms)
dd <- datadist(model_data)
options(datadist = "dd")
fit <- orm(y ~ tx + rcs(time, 4) + yprev, data = model_data, x = TRUE, y = TRUE)
fit_robust <- robcov(fit, cluster = model_data$id)

# Fit with ordinal
library(ordinal)
fit <- clm(y ~ tx + time + yprev, data = model_data)
}

}
