% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/misc.R
\name{format_competing_risks}
\alias{format_competing_risks}
\title{Format Time-to-Event Output for Competing Risks}
\usage{
format_competing_risks(
  data,
  event_status = 1,
  death_status = 6,
  version_old = TRUE
)
}
\arguments{
\item{data}{A data frame produced by \code{states_to_tte()} containing at least
columns \code{id}, \code{start}, \code{stop}, \code{y} (state), and \code{tx}.}

\item{event_status}{Integer code identifying the event of interest (e.g., discharge)
in the \code{y} column (default: 1).}

\item{death_status}{Integer code identifying the competing event (e.g., death)
in the \code{y} column (default: 6).}
}
\value{
A data frame where each row represents an interval at risk. The output
includes a \code{status} column:
\itemize{
\item \code{0}: Censored (no event observed or lost to follow-up)
\item \code{1}: Event of interest occurred at the end of this interval
\item \code{2}: Competing event occurred at the end of this interval
}
Rows where \code{y} matches \code{event_status} or \code{death_status} are removed.
}
\description{
This function transforms "state occupancy" data into "time-to-event" data.
It looks ahead to the subsequent interval to detect when a subject transitions
from a generic state to an event state. The interval ending at that transition
is assigned the corresponding event status. Rows representing the absorbing
states themselves are excluded, as the subject is no longer at risk.
}
\details{
Prepares the output from \code{states_to_tte()} for competing-risks analysis
(e.g., Fine-Gray or Cause-Specific Cox) by identifying transitions from
a risk state (e.g., hospital) to an absorbing state (e.g., discharge or death).

The function performs the following steps for each subject (\code{id}):
\enumerate{
\item \strong{Sorts} the data by time (\code{start}) to ensure chronological order.
\item \strong{Looks ahead} to the state (\code{y}) of the \emph{next} interval.
\item \strong{Assigns status}:
\itemize{
\item If the \emph{next} state is \code{event_status}, the current interval gets \code{status = 1}.
\item If the \emph{next} state is \code{death_status}, the current interval gets \code{status = 2}.
\item Otherwise, \code{status = 0}.
}
\item \strong{Filters}: Removes rows where the subject is already in an absorbing
state (\code{event_status} or \code{death_status}), as they are no longer at risk.
\item \strong{Truncates}: Ensures only the trajectory up to the first observed event
is retained per subject.
}
}
\examples{
\dontrun{
tte <- states_to_tte(trajectories)
# Prepare for Fine-Gray model (1=Discharge vs 2=Death)
fg_ready <- format_competing_risks(tte, event_status = 1, death_status = 6)
}

}
